<!DOCTYPE html>
    <html lang="zh-CN">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>中小学题库生成器</title>
      <script src="https://cdn.tailwindcss.com"></script>
      <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
      <script>
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                primary: '#3B82F6',
                secondary: '#10B981',
                accent: '#F59E0B',
                dark: '#1F2937',
                light: '#F3F4F6'
              },
              fontFamily: {
                sans: ['Inter', 'system-ui', 'sans-serif'],
              },
            },
          }
        }
      </script>
      <style type="text/tailwindcss">
        @layer utilities {
          .content-auto {
            content-visibility: auto;
          }
          .text-shadow {
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
          }
          .transition-custom {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          }
          .paper-container {
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 10mm auto;
            background-color: white;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
          }
          .page-break {
            page-break-after: always;
          }
        }
      </style>
      <script>
        document.addEventListener('DOMContentLoaded', function () {
          const gradeBtns = document.querySelectorAll('.grade-btn');
          const stepBtns = document.querySelectorAll('.step-btn');
          const stepContents = document.querySelectorAll('.step-content');
          const nextToStep2 = document.getElementById('next-to-step-2');
          const nextToStep3 = document.getElementById('next-to-step-3');
          const backToStep1 = document.getElementById('back-to-step-1');
          const backToStep2 = document.getElementById('back-to-step-2');
          const nextToStep4 = document.getElementById('next-to-step-4');
          const subjectsContainer = document.getElementById('subjects-container');
          const selectedGradeDisplay = document.getElementById('selected-grade-display');
          const selectedSubjectsDisplay = document.getElementById('selected-subjects-display');
          const questionCountInput = document.getElementById('question-count');
          const questionTypeCheckboxes = document.querySelectorAll('.question-type-checkbox');
          const difficultySliders = document.querySelectorAll('.difficulty-slider');
          const easyValue = document.getElementById('easy-value');
          const mediumValue = document.getElementById('medium-value');
          const hardValue = document.getElementById('hard-value');
          const fileFormatSelect = document.getElementById('file-format');
          
          let selectedGrade = null;
          let selectedSubjects = [];
          let currentQuestionBank = '';
          
          // 初始化滑块事件
          difficultySliders.forEach(slider => {
            slider.addEventListener('input', function() {
              updateDifficultyDisplay(this);
              validateDifficultyDistribution();
            });
          });
          
          gradeBtns.forEach(btn => {
            btn.addEventListener('click', function () {
              gradeBtns.forEach(btn => btn.classList.remove('bg-primary/20'));
              this.classList.add('bg-primary/20');
              selectedGrade = this.dataset.grade;
              selectedGradeDisplay.textContent = selectedGrade;
              nextToStep2.disabled = false;
            });
          });
          
          nextToStep2.addEventListener('click', function () {
            showStep(2);
            generateSubjects(selectedGrade);
          });
          
          backToStep1.addEventListener('click', function () {
            showStep(1);
          });
          
          nextToStep3.addEventListener('click', function () {
            showStep(3);
          });
          
          backToStep2.addEventListener('click', function () {
            showStep(2);
          });
          
          nextToStep4.addEventListener('click', function () {
            showStep(4);
            generateQuestionBank();
          });
          
          function showStep(step) {
            stepBtns.forEach(btn => {
              if (btn.dataset.step == step) {
                btn.classList.add('active');
                btn.classList.remove('text-gray-500');
                btn.querySelector('span').classList.add('bg-primary', 'text-white');
                btn.querySelector('span').classList.remove('bg-gray-300', 'text-gray-700');
              } else {
                btn.classList.remove('active');
                btn.classList.add('text-gray-500');
                btn.querySelector('span').classList.remove('bg-primary', 'text-white');
                btn.querySelector('span').classList.add('bg-gray-300', 'text-gray-700');
              }
            });
            
            stepContents.forEach(content => {
              if (content.id == `step-${step}`) {
                content.classList.remove('hidden');
              } else {
                content.classList.add('hidden');
              }
            });
            
            // 如果是第三步，滚动到顶部
            if (step === 3) {
              document.getElementById('step-3').scrollIntoView({ behavior: 'smooth' });
            }
          }
          
          function generateSubjects(grade) {
            subjectsContainer.innerHTML = '';
            selectedSubjects = [];
            selectedSubjectsDisplay.innerHTML = '';
            nextToStep3.disabled = true;
            
            let subjects = [];
            if (grade === '幼儿园') {
              subjects = ['拼音', '数学'];
            } else if (['一年级', '二年级'].includes(grade)) {
              subjects = ['语文', '数学', '英语'];
            } else {
              subjects = ['语文', '数学', '英语', '科学'];
            }
            
            subjects.forEach(subject => {
              const subjectBtn = document.createElement('button');
              subjectBtn.classList.add('subject-btn', 'bg-gray-100', 'hover:bg-gray-200', 'p-4', 'rounded-lg', 'text-center', 'transition-colors');
              subjectBtn.dataset.subject = subject;
              subjectBtn.innerHTML = `
                <div class="text-2xl font-bold mb-1">${subject}</div>
                <div class="text-sm text-gray-600">${grade}课程</div>
              `;
              subjectBtn.addEventListener('click', function () {
                if (this.classList.contains('bg-primary/20')) {
                  this.classList.remove('bg-primary/20');
                  selectedSubjects = selectedSubjects.filter(s => s !== subject);
                } else {
                  this.classList.add('bg-primary/20');
                  selectedSubjects.push(subject);
                }
                updateSelectedSubjectsDisplay();
                nextToStep3.disabled = selectedSubjects.length === 0;
              });
              subjectsContainer.appendChild(subjectBtn);
            });
          }
          
          function updateSelectedSubjectsDisplay() {
            selectedSubjectsDisplay.innerHTML = '';
            selectedSubjects.forEach(subject => {
              const subjectSpan = document.createElement('span');
              subjectSpan.classList.add('inline-flex', 'items-center', 'bg-primary/10', 'text-primary', 'px-3', 'py-1', 'rounded-full', 'text-sm');
              subjectSpan.innerHTML = `
                ${subject}
                <button class="ml-1 text-primary/70 hover:text-primary"><i class="fa fa-times-circle"></i></button>
              `;
              subjectSpan.querySelector('button').addEventListener('click', function () {
                const subjectToRemove = subjectSpan.textContent.trim();
                selectedSubjects = selectedSubjects.filter(s => s !== subjectToRemove);
                updateSelectedSubjectsDisplay();
                const subjectBtn = Array.from(subjectsContainer.children).find(btn => btn.dataset.subject === subjectToRemove);
                subjectBtn.classList.remove('bg-primary/20');
                nextToStep3.disabled = selectedSubjects.length === 0;
              });
              selectedSubjectsDisplay.appendChild(subjectSpan);
            });
          }
          
          function updateDifficultyDisplay(slider) {
            const valueDisplay = document.getElementById(`${slider.dataset.difficulty}-value`);
            valueDisplay.textContent = `${slider.value}%`;
          }
          
          function validateDifficultyDistribution() {
            const easy = parseInt(difficultySliders[0].value);
            const medium = parseInt(difficultySliders[1].value);
            const hard = parseInt(difficultySliders[2].value);
            const total = easy + medium + hard;
            
            if (total !== 100) {
              document.querySelector('#step-3 p.text-gray-500').textContent = `难度百分比总和应为100%，当前为${total}%`;
              document.querySelector('#step-3 p.text-gray-500').classList.add('text-red-500');
              document.querySelector('#step-3 p.text-gray-500').classList.remove('text-gray-500');
              nextToStep4.disabled = true;
            } else {
              document.querySelector('#step-3 p.text-gray-500').textContent = '难度百分比总和应为100%';
              document.querySelector('#step-3 p.text-gray-500').classList.remove('text-red-500');
              document.querySelector('#step-3 p.text-gray-500').classList.add('text-gray-500');
              nextToStep4.disabled = false;
            }
          }
          
          function generateQuestionBank() {
            const questionCount = parseInt(questionCountInput.value);
            const questionTypes = Array.from(questionTypeCheckboxes).filter(checkbox => checkbox.checked).map(checkbox => checkbox.value);
            const easyDifficulty = parseInt(difficultySliders[0].value);
            const mediumDifficulty = parseInt(difficultySliders[1].value);
            const hardDifficulty = parseInt(difficultySliders[2].value);
            
            // 创建题库容器
            const questionBankContainer = document.createElement('div');
            questionBankContainer.classList.add('paper-container', 'mb-8');
            
            // 添加试卷标题
            const title = document.createElement('h1');
            title.classList.add('text-center', 'text-2xl', 'font-bold', 'mb-8');
            title.textContent = `${selectedGrade}${selectedSubjects.join('、')}题库`;
            questionBankContainer.appendChild(title);
            
            // 添加试卷信息
            const info = document.createElement('div');
            info.classList.add('text-center', 'text-sm', 'text-gray-600', 'mb-6');
            info.innerHTML = `题目数量：${questionCount}题 | 难度分布：简单${easyDifficulty}%、中等${mediumDifficulty}%、困难${hardDifficulty}%`;
            questionBankContainer.appendChild(info);
            
            // 按题型分组
            const questionsByType = {};
            questionTypes.forEach(type => {
              questionsByType[type] = [];
            });
            
            // 生成题目
            for (let i = 0; i < questionCount; i++) {
              const randomSubject = selectedSubjects[Math.floor(Math.random() * selectedSubjects.length)];
              const randomQuestionType = questionTypes[Math.floor(Math.random() * questionTypes.length)];
              const randomDifficulty = getRandomDifficulty(easyDifficulty, mediumDifficulty, hardDifficulty);
              
              let question = generateCartoonQuestion(randomSubject, randomQuestionType, randomDifficulty);
              questionsByType[randomQuestionType].push({
                subject: randomSubject,
                question: question,
                difficulty: randomDifficulty
              });
            }
            
            // 按题型添加题目
            let questionNumber = 1;
            for (const [type, questions] of Object.entries(questionsByType)) {
              if (questions.length > 0) {
                // 添加题型标题
                const typeTitle = document.createElement('h2');
                typeTitle.classList.add('text-xl', 'font-bold', 'mt-8', 'mb-4', 'border-b', 'pb-2');
                typeTitle.textContent = `${type}（共${questions.length}题）`;
                questionBankContainer.appendChild(typeTitle);
                
                // 添加题目
                questions.forEach(q => {
                  const questionDiv = document.createElement('div');
                  questionDiv.classList.add('mb-6', 'p-4', 'border', 'border-gray-200', 'rounded-lg', 'bg-gray-50');
                  
                  // 题目编号和内容
                  const questionContent = document.createElement('p');
                  questionContent.classList.add('font-medium', 'mb-2');
                  questionContent.innerHTML = `题目 ${questionNumber}：${q.question}`;
                  questionDiv.appendChild(questionContent);
                  
                  // 题目科目和难度
                  const meta = document.createElement('p');
                  meta.classList.add('text-sm', 'text-gray-500');
                  meta.innerHTML = `${q.subject} | <span class="${getDifficultyClass(q.difficulty)}">${q.difficulty}</span>`;
                  questionDiv.appendChild(meta);
                  
                  questionBankContainer.appendChild(questionDiv);
                  questionNumber++;
                });
              }
            }
            
            // 清空步骤4并添加题库
            const step4 = document.getElementById('step-4');
            step4.innerHTML = '';
            step4.appendChild(questionBankContainer);
            
            // 添加下载选项
            const downloadContainer = document.createElement('div');
            downloadContainer.classList.add('flex', 'flex-col', 'md:flex-row', 'justify-center', 'items-center', 'gap-4', 'mt-8');
            
            // 文件格式选择
            const formatSelect = document.createElement('select');
            formatSelect.id = 'file-format';
            formatSelect.classList.add('px-4', 'py-2', 'border', 'border-gray-300', 'rounded-lg', 'focus:ring-2', 'focus:ring-primary', 'focus:border-primary');
            formatSelect.innerHTML = `
              <option value="pdf">PDF格式</option>
              <option value="word">Word格式</option>
              <option value="txt">纯文本格式</option>
            `;
            downloadContainer.appendChild(formatSelect);
            
            // 下载按钮
            const downloadBtn = document.createElement('button');
            downloadBtn.classList.add('bg-primary', 'text-white', 'px-6', 'py-3', 'rounded-lg', 'font-medium', 'hover:bg-primary/90', 'transition-colors');
            downloadBtn.innerHTML = '<i class="fa fa-download mr-2"></i>下载题库';
            downloadBtn.addEventListener('click', function () {
              const format = formatSelect.value;
              const fileName = `${selectedGrade}-${selectedSubjects.join('、')}题库.${format}`;
              
              if (format === 'pdf') {
                downloadAsPDF(questionBankContainer, fileName);
              } else if (format === 'word') {
                downloadAsWord(questionBankContainer, fileName);
              } else {
                downloadAsText(questionBankContainer, fileName);
              }
              
              // 重置题库生成器
              setTimeout(() => {
                resetGenerator();
              }, 1000);
            });
            downloadContainer.appendChild(downloadBtn);
            
            // 重置按钮
            const resetBtn = document.createElement('button');
            resetBtn.classList.add('bg-gray-200', 'text-gray-700', 'px-6', 'py-3', 'rounded-lg', 'font-medium', 'hover:bg-gray-300', 'transition-colors');
            resetBtn.innerHTML = '<i class="fa fa-refresh mr-2"></i>重新生成';
            resetBtn.addEventListener('click', resetGenerator);
            downloadContainer.appendChild(resetBtn);
            
            step4.appendChild(downloadContainer);
            
            // 保存当前题库内容
            currentQuestionBank = questionBankContainer.innerHTML;
          }
          
          function getRandomDifficulty(easy, medium, hard) {
            const random = Math.random() * 100;
            if (random < easy) {
              return '简单';
            } else if (random < easy + medium) {
              return '中等';
            } else {
              return '困难';
            }
          }
          
          function getDifficultyClass(difficulty) {
            switch(difficulty) {
              case '简单':
                return 'text-green-600';
              case '中等':
                return 'text-yellow-600';
              case '困难':
                return 'text-red-600';
              default:
                return 'text-gray-600';
            }
          }
          
          function generateCartoonQuestion(subject, questionType, difficulty) {
            let question = '';
            
            // 拼音题库
            if (subject === '拼音') {
              const pinyinMap = {
                '简单': [
                  { question: '“爸爸”的拼音是 ______。', answer: 'bà ba' },
                  { question: '“妈妈”的拼音是 ______。', answer: 'mā ma' },
                  { question: '“苹果”的拼音是 ______。', answer: 'píng guǒ' },
                  { question: '“学校”的拼音是 ______。', answer: 'xué xiào' },
                  { question: '“老师”的拼音是 ______。', answer: 'lǎo shī' }
                ],
                '中等': [
                  { question: '“朋友”的拼音是 ______。', answer: 'péng you' },
                  { question: '“快乐”的拼音是 ______。', answer: 'kuài lè' },
                  { question: '“唱歌”的拼音是 ______。', answer: 'chàng gē' },
                  { question: '“跳舞”的拼音是 ______。', answer: 'tiào wǔ' },
                  { question: '“书本”的拼音是 ______。', answer: 'shū běn' }
                ],
                '困难': [
                  { question: '“美丽”的拼音是 ______。', answer: 'měi lì' },
                  { question: '“早晨”的拼音是 ______。', answer: 'zǎo chen' },
                  { question: '“晚安”的拼音是 ______。', answer: 'wǎn ān' },
                  { question: '“学习”的拼音是 ______。', answer: 'xué xí' },
                  { question: '“聪明”的拼音是 ______。', answer: 'cōng míng' }
                ]
              };
              
              const choicesMap = {
                '简单': [
                  { question: '“花朵”的拼音是（  ）A. huā duǒ  B. huǒ duǒ', answer: 'A' },
                  { question: '“小鸟”的拼音是（  ）A. xiǎo niǎo  B. xiǎo yǎo', answer: 'A' },
                  { question: '“太阳”的拼音是（  ）A. tài yáng  B. dà yáng', answer: 'A' },
                  { question: '“月亮”的拼音是（  ）A. yuè liàng  B. yù liàng', answer: 'A' },
                  { question: '“星星”的拼音是（  ）A. xīng xing  B. xīn xing', answer: 'A' }
                ],
                '中等': [
                  { question: '“绿色”的拼音是（  ）A. lǜ sè  B. nǜ sè', answer: 'A' },
                  { question: '“黄色”的拼音是（  ）A. huáng sè  B. fáng sè', answer: 'A' },
                  { question: '“红色”的拼音是（  ）A. hóng sè  B. fēng sè', answer: 'A' },
                  { question: '“蓝色”的拼音是（  ）A. lán sè  B. nán sè', answer: 'A' },
                  { question: '“白色”的拼音是（  ）A. bái sè  B. pái sè', answer: 'A' }
                ],
                '困难': [
                  { question: '“铅笔”的拼音是（  ）A. qiān bǐ  B. jiān bǐ', answer: 'A' },
                  { question: '“橡皮”的拼音是（  ）A. xiàng pí  B. xiàn pí', answer: 'A' },
                  { question: '“尺子”的拼音是（  ）A. chǐ zi  B. cǐ zi', answer: 'A' },
                  { question: '“书包”的拼音是（  ）A. shū bāo  B. sū bāo', answer: 'A' },
                  { question: '“作业”的拼音是（  ）A. zuò yè  B. zhuò yè', answer: 'A' }
                ]
              };
              
              if (questionType === '选择题') {
                const randomIndex = Math.floor(Math.random() * choicesMap[difficulty].length);
                return choicesMap[difficulty][randomIndex].question;
              } else if (questionType === '填空题') {
                const randomIndex = Math.floor(Math.random() * pinyinMap[difficulty].length);
                return pinyinMap[difficulty][randomIndex].question;
              }
            }
            
            // 数学题库
            else if (subject === '数学') {
              if (['幼儿园', '一年级', '二年级'].includes(selectedGrade)) {
                // 低年级数学题库
                const mathMap = {
                  '简单': [
                    { question: '2 + 3 = ______', answer: '5' },
                    { question: '5 - 1 = ______', answer: '4' },
                    { question: '4 + 1 = ______', answer: '5' },
                    { question: '6 - 3 = ______', answer: '3' },
                    { question: '3 + 2 = ______', answer: '5' }
                  ],
                  '中等': [
                    { question: '7 - 4 = ______', answer: '3' },
                    { question: '2 + 6 = ______', answer: '8' },
                    { question: '9 - 5 = ______', answer: '4' },
                    { question: '3 + 4 = ______', answer: '7' },
                    { question: '8 - 2 = ______', answer: '6' }
                  ],
                  '困难': [
                    { question: '5 + 4 = ______', answer: '9' },
                    { question: '10 - 3 = ______', answer: '7' },
                    { question: '6 + 3 = ______', answer: '9' },
                    { question: '9 - 4 = ______', answer: '5' },
                    { question: '4 + 5 = ______', answer: '9' }
                  ]
                };
                
                const mathChoicesMap = {
                  '简单': [
                    { question: '3 + 4 = （  ）A. 5  B. 6  C. 7', answer: 'C' },
                    { question: '8 - 5 = （  ）A. 2  B. 3  C. 4', answer: 'B' },
                    { question: '2 + 5 = （  ）A. 6  B. 7  C. 8', answer: 'B' },
                    { question: '7 - 3 = （  ）A. 3  B. 4  C. 5', answer: 'B' },
                    { question: '4 + 3 = （  ）A. 6  B. 7  C. 8', answer: 'B' }
                  ],
                  '中等': [
                    { question: '9 - 6 = （  ）A. 2  B. 3  C. 4', answer: 'B' },
                    { question: '5 + 3 = （  ）A. 7  B. 8  C. 9', answer: 'B' },
                    { question: '10 - 4 = （  ）A. 5  B. 6  C. 7', answer: 'B' },
                    { question: '3 + 5 = （  ）A. 7  B. 8  C. 9', answer: 'B' },
                    { question: '8 - 3 = （  ）A. 4  B. 5  C. 6', answer: 'B' }
                  ],
                  '困难': [
                    { question: '6 + 4 = （  ）A. 8  B. 9  C. 10', answer: 'C' },
                    { question: '10 - 5 = （  ）A. 4  B. 5  C. 6', answer: 'B' },
                    { question: '7 + 3 = （  ）A. 9  B. 10  C. 11', answer: 'B' },
                    { question: '10 - 2 = （  ）A. 7  B. 8  C. 9', answer: 'B' },
                    { question: '5 + 5 = （  ）A. 9  B. 10  C. 11', answer: 'B' }
                  ]
                };
                
                if (questionType === '选择题') {
                  const randomIndex = Math.floor(Math.random() * mathChoicesMap[difficulty].length);
                  return mathChoicesMap[difficulty][randomIndex].question;
                } else if (questionType === '填空题') {
                  const randomIndex = Math.floor(Math.random() * mathMap[difficulty].length);
                  return mathMap[difficulty][randomIndex].question;
                }
              } else {
                // 高年级数学题库
                const mathMap = {
                  '简单': [
                    { question: '长方形的长是5厘米，宽是3厘米，它的周长是 ______ 厘米。', answer: '16' },
                    { question: '小明有10个苹果，给了小红3个，还剩下 ______ 个。', answer: '7' },
                    { question: '36 ÷ 4 = ______', answer: '9' },
                    { question: '5 × 6 = ______', answer: '30' },
                    { question: '1米 = ______ 厘米', answer: '100' }
                  ],
                  '中等': [
                    { question: '一个三角形的底是6厘米，高是4厘米，它的面积是 ______ 平方厘米。', answer: '12' },
                    { question: '小华买了3支铅笔，每支2元，一共花了 ______ 元。', answer: '6' },
                    { question: '48 ÷ 6 = ______', answer: '8' },
                    { question: '7 × 8 = ______', answer: '56' },
                    { question: '1小时 = ______ 分钟', answer: '60' }
                  ],
                  '困难': [
                    { question: '一个圆柱的底面半径是3厘米，高是5厘米，它的体积是 ______ 立方厘米。（π取3.14）', answer: '141.3' },
                    { question: '小李从家到学校要走15分钟，如果他早上7:30从家出发，______ 到达学校。', answer: '7:45' },
                    { question: '56 ÷ 7 = ______', answer: '8' },
                    { question: '9 × 7 = ______', answer: '63' },
                    { question: '1千克 = ______ 克', answer: '1000' }
                  ]
                };
                
                const mathChoicesMap = {
                  '简单': [
                    { question: '12 ÷ 3 = （  ）A. 3  B. 4  C. 5', answer: 'B' },
                    { question: '4 × 6 = （  ）A. 20  B. 24  C. 28', answer: 'B' },
                    { question: '正方形的边长是4厘米，它的周长是（  ）厘米。A. 12  B. 16  C. 20', answer: 'B' },
                    { question: '30 ÷ 5 = （  ）A. 5  B. 6  C. 7', answer: 'B' },
                    { question: '5 × 7 = （  ）A. 30  B. 35  C. 40', answer: 'B' }
                  ],
                  '中等': [
                    { question: '24 ÷ 4 = （  ）A. 5  B. 6  C. 7', answer: 'B' },
                    { question: '6 × 8 = （  ）A. 42  B. 48  C. 54', answer: 'B' },
                    { question: '一个长方形的长是7厘米，宽是3厘米，它的面积是（  ）平方厘米。A. 21  B. 24  C. 28', answer: 'A' },
                    { question: '45 ÷ 9 = （  ）A. 4  B. 5  C. 6', answer: 'B' },
                    { question: '7 × 9 = （  ）A. 56  B. 63  C. 70', answer: 'B' }
                  ],
                  '困难': [
                    { question: '56 ÷ 8 = （  ）A. 6  B. 7  C. 8', answer: 'B' },
                    { question: '8 × 9 = （  ）A. 64  B. 72  C. 80', answer: 'B' },
                    { question: '一个圆的半径是3厘米，它的周长是（  ）厘米。（π取3.14）A. 18.84  B. 28.26  C. 9.42', answer: 'A' },
                    { question: '72 ÷ 9 = （  ）A. 7  B. 8  C. 9', answer: 'B' },
                    { question: '9 × 9 = （  ）A. 72  B. 81  C. 90', answer: 'B' }
                  ]
                };
                
                if (questionType === '选择题') {
                  const randomIndex = Math.floor(Math.random() * mathChoicesMap[difficulty].length);
                  return mathChoicesMap[difficulty][randomIndex].question;
                } else if (questionType === '填空题') {
                  const randomIndex = Math.floor(Math.random() * mathMap[difficulty].length);
                  return mathMap[difficulty][randomIndex].question;
                }
              }
            }
            
            // 英语题库
            else if (subject === '英语') {
              const englishMap = {
                '简单': [
                  { question: '“苹果”的英文是 ______。', answer: 'apple' },
                  { question: '“猫”的英文是 ______。', answer: 'cat' },
                  { question: '“狗”的英文是 ______。', answer: 'dog' },
                  { question: '“书”的英文是 ______。', answer: 'book' },
                  { question: '“笔”的英文是 ______。', answer: 'pen' }
                ],
                '中等': [
                  { question: '“红色”的英文是 ______。', answer: 'red' },
                  { question: '“蓝色”的英文是 ______。', answer: 'blue' },
                  { question: '“绿色”的英文是 ______。', answer: 'green' },
                  { question: '“黄色”的英文是 ______。', answer: 'yellow' },
                  { question: '“白色”的英文是 ______。', answer: 'white' }
                ],
                '困难': [
                  { question: '“早上好”的英文是 ______。', answer: 'good morning' },
                  { question: '“谢谢你”的英文是 ______。', answer: 'thank you' },
                  { question: '“再见”的英文是 ______。', answer: 'goodbye' },
                  { question: '“我爱你”的英文是 ______。', answer: 'I love you' },
                  { question: '“请”的英文是 ______。', answer: 'please' }
                ]
              };
              
              const englishChoicesMap = {
                '简单': [
                  { question: '“香蕉”的英文是（  ）A. apple  B. banana  C. orange', answer: 'B' },
                  { question: '“鸟”的英文是（  ）A. bird  B. cat  C. dog', answer: 'A' },
                  { question: '“鱼”的英文是（  ）A. fish  B. bird  C. cat', answer: 'A' },
                  { question: '“帽子”的英文是（  ）A. hat  B. cat  C. dog', answer: 'A' },
                  { question: '“桌子”的英文是（  ）A. table  B. chair  C. bed', answer: 'A' }
                ],
                '中等': [
                  { question: '“黑色”的英文是（  ）A. black  B. blue  C. brown', answer: 'A' },
                  { question: '“粉色”的英文是（  ）A. purple  B. pink  C. orange', answer: 'B' },
                  { question: '“紫色”的英文是（  ）A. purple  B. pink  C. orange', answer: 'A' },
                  { question: '“橙色”的英文是（  ）A. purple  B. pink  C. orange', answer: 'C' },
                  { question: '“棕色”的英文是（  ）A. black  B. blue  C. brown', answer: 'C' }
                ],
                '困难': [
                  { question: '“你好吗？”的英文是（  ）A. How are you?  B. What\'s your name?  C. Goodbye.', answer: 'A' },
                  { question: '“我叫小明。”的英文是（  ）A. My name is Xiaoming.  B. I am Xiaoming.  C. Both A and B.', answer: 'C' },
                  { question: '“这是什么？”的英文是（  ）A. What\'s this?  B. What\'s that?  C. Who\'s this?', answer: 'A' },
                  { question: '“那是什么？”的英文是（  ）A. What\'s this?  B. What\'s that?  C. Who\'s that?', answer: 'B' },
                  { question: '“几点了？”的英文是（  ）A. What\'s your name?  B. What time is it?  C. How old are you?', answer: 'B' }
                ]
              };
              
              if (questionType === '选择题') {
                const randomIndex = Math.floor(Math.random() * englishChoicesMap[difficulty].length);
                return englishChoicesMap[difficulty][randomIndex].question;
              } else if (questionType === '填空题') {
                const randomIndex = Math.floor(Math.random() * englishMap[difficulty].length);
                return englishMap[difficulty][randomIndex].question;
              }
            }
            
            // 科学题库
            else if (subject === '科学') {
              const scienceMap = {
                '简单': [
                  { question: '太阳从 ______ 方升起。', answer: '东' },
                  { question: '一年有 ______ 个季节。', answer: '4' },
                  { question: '水在 ______℃ 时会沸腾。', answer: '100' },
                  { question: '人类有 ______ 条腿。', answer: '2' },
                  { question: '猫有 ______ 条腿。', answer: '4' }
                ],
                '中等': [
                  { question: '植物通过 ______ 进行光合作用。', answer: '叶子' },
                  { question: '地球围绕 ______ 旋转。', answer: '太阳' },
                  { question: '月亮本身 ______ 发光。（填“会”或“不会”）', answer: '不会' },
                  { question: '人体最大的器官是 ______。', answer: '皮肤' },
                  { question: '空气中含量最多的气体是 ______。', answer: '氮气' }
                ],
                '困难': [
                  { question: '太阳系中最大的行星是 ______。', answer: '木星' },
                  { question: '声音在 ______ 中传播速度最快。（填“固体”、“液体”或“气体”）', answer: '固体' },
                  { question: '光合作用的产物是 ______ 和氧气。', answer: '葡萄糖' },
                  { question: '人体的血液循环系统由心脏、血管和 ______ 组成。', answer: '血液' },
                  { question: '电的单位是 ______。', answer: '安培' }
                ]
              };
              
              const scienceChoicesMap = {
                '简单': [
                  { question: '下列哪种动物会飞？（  ）A. 猫  B. 狗  C. 鸟', answer: 'C' },
                  { question: '水在0℃时会（  ）A. 沸腾  B. 结冰  C. 蒸发', answer: 'B' },
                  { question: '下列哪种是水果？（  ）A. 胡萝卜  B. 苹果  C. 土豆', answer: 'B' },
                  { question: '下列哪种是蔬菜？（  ）A. 香蕉  B. 西红柿  C. 葡萄', answer: 'B' },
                  { question: '下列哪种是动物？（  ）A. 树  B. 花  C. 鱼', answer: 'C' }
                ],
                '中等': [
                  { question: '下列哪种是哺乳动物？（  ）A. 鸟  B. 鱼  C. 猫', answer: 'C' },
                  { question: '下列哪种是爬行动物？（  ）A. 青蛙  B. 蛇  C. 鸟', answer: 'B' },
                  { question: '下列哪种是昆虫？（  ）A. 蜘蛛  B. 蚂蚁  C. 蜗牛', answer: 'B' },
                  { question: '下列哪种是两栖动物？（  ）A. 蛇  B. 青蛙  C. 乌龟', answer: 'B' },
                  { question: '下列哪种是鱼类？（  ）A. 海豚  B. 鲨鱼  C. 鲸鱼', answer: 'B' }
                ],
                '困难': [
                  { question: '下列哪种是可再生能源？（  ）A. 石油  B. 太阳能  C. 煤炭', answer: 'B' },
                  { question: '下列哪种是化学变化？（  ）A. 水结冰  B. 铁生锈  C. 盐溶解', answer: 'B' },
                  { question: '下列哪种是物理变化？（  ）A. 燃烧木材  B. 水沸腾  C. 食物腐烂', answer: 'B' },
                  { question: '下列哪种是导体？（  ）A. 木头  B. 铜  C. 塑料', answer: 'B' },
                  { question: '下列哪种是绝缘体？（  ）A. 铁  B. 玻璃  C. 铝', answer: 'B' }
                ]
              };
              
              if (questionType === '选择题') {
                const randomIndex = Math.floor(Math.random() * scienceChoicesMap[difficulty].length);
                return scienceChoicesMap[difficulty][randomIndex].question;
              } else if (questionType === '填空题') {
                const randomIndex = Math.floor(Math.random() * scienceMap[difficulty].length);
                return scienceMap[difficulty][randomIndex].question;
              }
            }
            
            return question;
          }
          
          function downloadAsPDF(element, fileName) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
              orientation: 'portrait',
              unit: 'mm',
              format: 'a4'
            });
            
            html2canvas(element, { scale: 2 }).then(canvas => {
              const imgData = canvas.toDataURL('image/png');
              const imgWidth = 210;
              const imgHeight = canvas.height * imgWidth / canvas.width;
              
              doc.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
              doc.save(fileName);
            });
          }
          
          function downloadAsWord(element, fileName) {
            const htmlContent = `
              <html xmlns:o="urn:schemas-microsoft-com:office:office" 
                    xmlns:w="urn:schemas-microsoft-com:office:word" 
                    xmlns="http://www.w3.org/TR/REC-html40">
                <head>
                  <meta charset="UTF-8">
                  <title>${fileName}</title>
                  <style>
                    body { font-family: 'Microsoft YaHei', sans-serif; }
                    h1 { text-align: center; }
                    .question { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
                    .meta { font-size: 12px; color: #666; }
                    .easy { color: green; }
                    .medium { color: orange; }
                    .hard { color: red; }
                  </style>
                </head>
                <body>
                  ${element.innerHTML}
                </body>
              </html>
            `;
            
            const blob = new Blob(['\ufeff', htmlContent], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          }
          
          function downloadAsText(element, fileName) {
            let textContent = '';
            
            // 获取标题
            const title = element.querySelector('h1').textContent;
            textContent += `${title}\n\n`;
            
            // 获取信息
            const info = element.querySelector('div.text-center.text-sm').textContent;
            textContent += `${info}\n\n`;
            
            // 获取所有题目
            const questions = element.querySelectorAll('div.mb-6');
            questions.forEach((question, index) => {
              const questionText = question.querySelector('p.font-medium').textContent;
              const meta = question.querySelector('p.text-sm').textContent;
              
              textContent += `${questionText}\n${meta}\n\n`;
            });
            
            const blob = new Blob([textContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
